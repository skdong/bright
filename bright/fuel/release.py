import json
import pprint


release_info = """{"compute-vmware": {"restrictions": [{"action": "hide", "condition": "settings:common.use_vcenter.value == false"}], "group": "compute", "name": "Compute VMware", "weight": 90, "tags": ["compute-vmware"], "conflicts": ["controller", "compute", "cinder", "cinder-block-device", "ceph-osd", "mongo", "base-os", "virt", "ironic"], "description": "A node that runs nova-compute with VCDriver, that manages ESXi computing resources via VMware vCenter."}, "compute": {"limits": {"recommended": 1}, "group": "compute", "name": "Compute", "weight": 20, "tags": ["compute"], "fault_tolerance": "2%", "public_for_dvr_required": true, "description": "A Compute node creates, manages, and terminates virtual machine instances."}, "cinder-vmware": {"restrictions": [{"action": "hide", "condition": "settings:common.use_vcenter.value == false"}], "group": "storage", "name": "Cinder Proxy to VMware Datastore", "limits": {"recommended": 1}, "tags": ["cinder-vmware"], "weight": 40, "description": "Cinder-VMware provides scheduling of block storage resources delivered over VMware vCenter. Block storage can be used for database storage, expandable file systems, or providing a server with access to raw block level devices."}, "virt": {"restrictions": [{"action": "hide", "condition": "not ('advanced' in version:feature_groups)"}], "group": "compute", "name": "Virtual", "weight": 80, "tags": ["virt"], "public_ip_required": true, "conflicts": ["controller", "base-os"], "description": "ADVANCED: Make available possibilities to spawn vms on this node that can be assign as a normal nodes."}, "base-os": {"description": "Install base Operating System without additional packages and configuration.", "group": "other", "name": "Operating System", "weight": 70, "tags": ["base-os"]}, "controller": {"limits": {"recommended": 3, "overrides": [{"message": "Neutron L3 HA requires at least 2 Controller nodes to function properly.", "condition": "settings:neutron_advanced_configuration.neutron_l3_ha.value == true", "min": 2}], "min": 1}, "group": "base", "name": "Controller", "weight": 10, "tags": ["controller", "rabbitmq", "database", "keystone", "neutron"], "update_required": ["compute", "cinder"], "conflicts": ["compute"], "public_ip_required": true, "has_primary": true, "public_for_dvr_required": true, "description": "The Controller initiates orchestration activities and provides an external API.  Other components like Glance (image storage), Keystone (identity management), Horizon (OpenStack dashboard) and Nova-Scheduler are installed on the controller as well."}, "cinder": {"restrictions": [{"message": "Cinder LVM should be enabled in the environment settings.", "condition": "settings:storage.volumes_lvm.value == false"}, {"message": "Ceph RBD cannot be used with Cinder", "condition": "settings:storage.volumes_ceph.value == true"}], "group": "storage", "name": "Cinder", "limits": {"recommended": 1}, "tags": ["cinder"], "weight": 30, "description": "Cinder provides scheduling of block storage resources, typically delivered over iSCSI and other compatible backend storage systems. Block storage can be used for database storage, expandable file systems, or to provide a server with access to raw block level devices."}, "ironic": {"restrictions": [{"message": "Ironic should be enabled in the environment settings.", "condition": "settings:additional_components.ironic.value == false"}], "group": "compute", "name": "Ironic", "limits": {"recommended": 3, "min": 1}, "tags": ["ironic"], "weight": 100, "conflicts": ["compute"], "description": "Ironic conductor."}, "ceph-osd": {"restrictions": [{"message": "Ceph should be enabled in the environment settings.", "condition": "settings:storage.volumes_ceph.value == false and settings:storage.images_ceph.value == false and settings:storage.ephemeral_ceph.value == false and settings:storage.objects_ceph.value == false"}], "group": "storage", "description": "Ceph storage can be configured to provide storage for block volumes (Cinder), images (Glance) and ephemeral instance storage (Nova). It can also provide object storage through the S3 and Swift API (See settings to enable each).", "limits": {"min": "settings:storage.osd_pool_size.value"}, "tags": ["ceph-osd"], "weight": 50, "update_once": ["controller"], "name": "Ceph OSD"}, "cinder-block-device": {"restrictions": [{"message": "Cinder Block Device driver should be enabled in the environment settings.", "condition": "settings:storage.volumes_block_device.value == false"}, {"message": "Ceph RBD cannot be used with Cinder Block Device", "condition": "settings:storage.volumes_ceph.value == true"}], "group": "storage", "name": "Cinder Block Device", "weight": 35, "tags": ["cinder-block-device"], "has_primary": false, "public_ip_required": false, "conflicts": ["controller", "cinder", "cinder-vmware", "ceph-osd"], "description": "Host node for Cinder Block Devices."}, "mongo": {"restrictions": [{"message": "Ceilometer should be enabled in the environment settings.", "condition": "settings:additional_components.ceilometer.value == false"}, {"message": "You are already using external MongoDB.", "condition": "settings:additional_components.mongo.value == true"}], "group": "other", "name": "Telemetry - MongoDB", "weight": 60, "tags": ["mongo"], "conflicts": ["compute", "ceph-osd"], "limits": {"overrides": [{"max": 1, "message": "At most 1 MongoDB node can be added for non-HA deployment", "condition": "cluster:mode != 'ha_compact'"}, {"recommended": 3, "message": "At least 3 MongoDB nodes are recommended for HA deployment.", "condition": "cluster:mode == 'ha_compact'"}], "min": 1}, "has_primary": true, "description": "A feature-complete and recommended database for storage of metering data from OpenStack Telemetry (Ceilometer)."}}"""

release = json.loads(release_info)
#pprint.pprint(release)

print release.keys()

#pprint.pprint(release.get('controller'))

def show_conflicts(release):
    for role in release:
        if release.get(role).get('conflicts', None):
            print role, release.get(role).get('conflicts')

del release['controller']['conflicts']
del release['mongo']['conflicts']
show_conflicts(release)
print json.dumps(release)


new = """{"compute-vmware": {"restrictions": [{"action": "hide", "condition": "settings:common.use_vcenter.value == false"}], "group": "compute", "name": "Compute VMware", "weight": 90, "tags": ["compute-vmware"], "conflicts": ["controller", "compute", "cinder", "cinder-block-device", "ceph-osd", "mongo", "base-os", "virt", "ironic"], "description": "A node that runs nova-compute with VCDriver, that manages ESXi computing resources via VMware vCenter."}, "compute": {"limits": {"recommended": 1}, "group": "compute", "name": "Compute", "weight": 20, "tags": ["compute"], "fault_tolerance": "2%", "public_for_dvr_required": true, "description": "A Compute node creates, manages, and terminates virtual machine instances."}, "cinder-vmware": {"restrictions": [{"action": "hide", "condition": "settings:common.use_vcenter.value == false"}], "group": "storage", "name": "Cinder Proxy to VMware Datastore", "weight": 40, "tags": ["cinder-vmware"], "limits": {"recommended": 1}, "description": "Cinder-VMware provides scheduling of block storage resources delivered over VMware vCenter. Block storage can be used for database storage, expandable file systems, or providing a server with access to raw block level devices."}, "virt": {"restrictions": [{"action": "hide", "condition": "not ('advanced' in version:feature_groups)"}], "group": "compute", "name": "Virtual", "weight": 80, "tags": ["virt"], "public_ip_required": true, "conflicts": ["controller", "base-os"], "description": "ADVANCED: Make available possibilities to spawn vms on this node that can be assign as a normal nodes."}, "base-os": {"tags": ["base-os"], "group": "other", "description": "Install base Operating System without additional packages and configuration.", "weight": 70, "name": "Operating System"}, "controller": {"limits": {"recommended": 3, "overrides": [{"message": "Neutron L3 HA requires at least 2 Controller nodes to function properly.", "condition": "settings:neutron_advanced_configuration.neutron_l3_ha.value == true", "min": 2}], "min": 1}, "group": "base", "name": "Controller", "weight": 10, "tags": ["controller", "rabbitmq", "database", "keystone", "neutron"], "update_required": ["compute", "cinder"], "has_primary": true, "public_ip_required": true, "public_for_dvr_required": true, "description": "The Controller initiates orchestration activities and provides an external API.  Other components like Glance (image storage), Keystone (identity management), Horizon (OpenStack dashboard) and Nova-Scheduler are installed on the controller as well."}, "ceph-osd": {"restrictions": [{"message": "Ceph should be enabled in the environment settings.", "condition": "settings:storage.volumes_ceph.value == false and settings:storage.images_ceph.value == false and settings:storage.ephemeral_ceph.value == false and settings:storage.objects_ceph.value == false"}], "group": "storage", "description": "Ceph storage can be configured to provide storage for block volumes (Cinder), images (Glance) and ephemeral instance storage (Nova). It can also provide object storage through the S3 and Swift API (See settings to enable each).", "weight": 50, "tags": ["ceph-osd"], "limits": {"min": "settings:storage.osd_pool_size.value"}, "update_once": ["controller"], "name": "Ceph OSD"}, "ironic": {"restrictions": [{"message": "Ironic should be enabled in the environment settings.", "condition": "settings:additional_components.ironic.value == false"}], "group": "compute", "name": "Ironic", "weight": 100, "tags": ["ironic"], "limits": {"recommended": 3, "min": 1}, "conflicts": ["compute"], "description": "Ironic conductor."}, "cinder": {"restrictions": [{"message": "Cinder LVM should be enabled in the environment settings.", "condition": "settings:storage.volumes_lvm.value == false"}, {"message": "Ceph RBD cannot be used with Cinder", "condition": "settings:storage.volumes_ceph.value == true"}], "group": "storage", "name": "Cinder", "weight": 30, "tags": ["cinder"], "limits": {"recommended": 1}, "description": "Cinder provides scheduling of block storage resources, typically delivered over iSCSI and other compatible backend storage systems. Block storage can be used for database storage, expandable file systems, or to provide a server with access to raw block level devices."}, "cinder-block-device": {"restrictions": [{"message": "Cinder Block Device driver should be enabled in the environment settings.", "condition": "settings:storage.volumes_block_device.value == false"}, {"message": "Ceph RBD cannot be used with Cinder Block Device", "condition": "settings:storage.volumes_ceph.value == true"}], "group": "storage", "name": "Cinder Block Device", "weight": 35, "tags": ["cinder-block-device"], "conflicts": ["controller", "cinder", "cinder-vmware", "ceph-osd"], "public_ip_required": false, "has_primary": false, "description": "Host node for Cinder Block Devices."}, "mongo": {"restrictions": [{"message": "Ceilometer should be enabled in the environment settings.", "condition": "settings:additional_components.ceilometer.value == false"}, {"message": "You are already using external MongoDB.", "condition": "settings:additional_components.mongo.value == true"}], "group": "other", "name": "Telemetry - MongoDB", "weight": 60, "tags": ["mongo"], "has_primary": true, "limits": {"overrides": [{"max": 1, "message": "At most 1 MongoDB node can be added for non-HA deployment", "condition": "cluster:mode != 'ha_compact'"}, {"recommended": 3, "message": "At least 3 MongoDB nodes are recommended for HA deployment.", "condition": "cluster:mode == 'ha_compact'"}], "min": 1}, "description": "A feature-complete and recommended database for storage of metering data from OpenStack Telemetry (Ceilometer)."}}"""

pprint.pprint(json.loads(new))